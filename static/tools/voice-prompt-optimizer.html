<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice to Prompt Converter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #1a1a2e;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.95;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #e0e0e0;
            font-size: 14px;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            background: #16213e;
            border: 2px solid #2d3561;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s, background 0.3s;
            color: #e0e0e0;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
            background: #1a2442;
        }
        
        textarea::placeholder {
            color: #6b7396;
        }
        
        #voiceInput {
            min-height: 120px;
        }
        
        #optimizedPrompt {
            min-height: 300px;
            background-color: #16213e;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .copy-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            margin-left: auto;
        }
        
        .copy-btn:hover {
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.5);
        }
        
        .example {
            background: #252d47;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
            color: #b8bdd0;
            border-left: 3px solid #667eea;
        }
        
        .example strong {
            color: #8b9eff;
        }
        
        #detectionResults {
            margin-top: 20px;
        }
        
        #detectionResults > div {
            background: #1e2940;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #48bb78;
        }
        
        #detectionResults .detected-header {
            font-weight: 600;
            margin-bottom: 10px;
            color: #6ee7b7;
        }
        
        #detectedInfo {
            font-size: 13px;
            color: #cbd5e0;
        }
        
        #detectedInfo strong {
            color: #a5b4fc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Voice to Prompt Converter</h1>
            <p>Transform casual voice input into structured, effective prompts</p>
        </div>
        
        <div class="content">
            <div class="section">
                <label for="voiceInput">Your Voice Input (paste transcription here):</label>
                <textarea id="voiceInput" placeholder="Just speak naturally! Example: so...um I need like a presentation or something, maybe 10 slides? About sales performance for the quarterly meeting you know with the team..."></textarea>
                <div class="example">
                    <strong>Tip:</strong> Don't worry about perfect grammar or complete sentences. The tool handles filler words ("um", "like", "you know"), false starts, repeated words, and fragmented thoughts. Just paste what you actually said.
                </div>
                <div class="example" style="margin-top: 10px; background: #2d2416; border-left: 4px solid #f59e0b;">
                    <strong>Examples of messy input this handles:</strong><br>
                    • "uh I need an email to send to the client about um the delay, make it professional I guess"<br>
                    • "presentation like 10 slides quarterly sales meeting you know performance targets"<br>
                    • "help me write write a blog post, maybe 800 words, about cybersecurity for small business"
                </div>
            </div>
            
            <div class="button-group">
                <button onclick="optimizePrompt()">Generate Optimized Prompt</button>
            </div>
            
            <div id="detectionResults" style="display: none; margin-top: 20px;">
                <div>
                    <div class="detected-header">✓ Detected from your input:</div>
                    <div id="detectedInfo"></div>
                </div>
            </div>
            
            <div class="section" style="margin-top: 30px;">
                <label for="optimizedPrompt">Optimized Prompt:</label>
                <textarea id="optimizedPrompt" placeholder="Your optimized prompt will appear here..." readonly></textarea>
                <div class="button-group">
                    <button class="copy-btn" onclick="copyPrompt()">Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function optimizePrompt() {
            const rawInput = document.getElementById('voiceInput').value.trim();
            
            if (!rawInput) {
                alert('Please enter your voice input first.');
                return;
            }
            
            // STEP 1: Detect task type FIRST using raw input (before cleaning destroys keywords)
            const taskType = detectTaskType(rawInput);
            
            // STEP 2: Context-aware cleaning (preserve task-critical words)
            const cleanedInput = cleanVoiceInput(rawInput, taskType);
            
            // STEP 3: Extract information with context and validation
            const analysis = analyzeInput(cleanedInput, rawInput, taskType);
            
            // STEP 4: Display what was detected
            displayDetectionResults(analysis);
            
            // STEP 5: Generate optimized prompt
            const optimized = generateOptimizedPrompt(cleanedInput, analysis);
            
            document.getElementById('optimizedPrompt').value = optimized;
        }
        
        function detectTaskType(rawInput) {
            const lower = rawInput.toLowerCase();
            
            // Score each task type based on multiple signals
            const scores = {
                email: 0,
                presentation: 0,
                analysis: 0,
                content: 0,
                brainstorm: 0,
                data: 0
            };
            
            // Email signals (strongest indicators first)
            if (lower.match(/\b(email|e-mail|mail)\b/)) scores.email += 10;
            if (lower.match(/\b(write|send|draft)\s+(an?\s+)?(email|message|letter)/i)) scores.email += 10;
            if (lower.match(/\bto\s+[A-Z][a-z]+\b/) && lower.match(/\b(write|send|draft)\b/)) scores.email += 5;
            if (lower.match(/\b(subject line|greeting|regards|sincerely)\b/)) scores.email += 7;
            
            // Presentation signals
            if (lower.match(/\b(presentation|powerpoint|ppt|keynote)\b/)) scores.presentation += 10;
            if (lower.match(/\b(slide|slides|deck)\b/)) scores.presentation += 10;
            if (lower.match(/\d+\s*slides?\b/)) scores.presentation += 8;
            if (lower.match(/\b(board meeting|conference|presenting to)\b/)) scores.presentation += 5;
            if (lower.match(/\b(speaker notes|talking points)\b/)) scores.presentation += 7;
            // Don't confuse "present findings" with "make presentation"
            if (lower.match(/\bpresent\s+(to|at|findings|results)\b/) && !lower.match(/\b(slide|deck)\b/)) scores.presentation -= 3;
            
            // Analysis signals
            if (lower.match(/\b(analyze|analysis|examine|review)\b/)) scores.analysis += 10;
            if (lower.match(/\b(summarize|summary|key takeaways)\b/)) scores.analysis += 10;
            if (lower.match(/\b(uploaded|attached|this report|this document)\b/)) scores.analysis += 7;
            if (lower.match(/\b(findings|insights|patterns|trends)\b/)) scores.analysis += 5;
            if (lower.match(/\btell me (what|about)/)) scores.analysis += 6;
            
            // Content creation signals
            if (lower.match(/\b(blog post|article|white paper|case study)\b/)) scores.content += 10;
            if (lower.match(/\b(write|create|draft|compose)\s+(a|an|some)?\s*(blog|article|post|content)\b/i)) scores.content += 10;
            if (lower.match(/\d+\s*words?\b/)) scores.content += 7;
            if (lower.match(/\b(seo|publish|readers|audience)\b/)) scores.content += 5;
            
            // Brainstorming signals
            if (lower.match(/\b(brainstorm|ideas|suggestions|options)\b/)) scores.brainstorm += 10;
            if (lower.match(/\b(come up with|think of|give me)\s+(some\s+)?(ideas|ways|options)/i)) scores.brainstorm += 10;
            if (lower.match(/\b(creative|innovative|possibilities)\b/)) scores.brainstorm += 5;
            
            // Data signals
            if (lower.match(/\b(spreadsheet|excel|csv|data)\b/)) scores.data += 10;
            if (lower.match(/\b(chart|graph|visualization|dashboard)\b/)) scores.data += 8;
            if (lower.match(/\b(calculate|metrics|statistics|numbers)\b/)) scores.data += 6;
            
            // Find highest score
            let maxScore = 0;
            let detectedType = 'general';
            
            for (const [type, score] of Object.entries(scores)) {
                if (score > maxScore) {
                    maxScore = score;
                    detectedType = type;
                }
            }
            
            // Require minimum confidence
            return maxScore >= 5 ? detectedType : 'general';
        }
        
        function cleanVoiceInput(input, taskType) {
            let cleaned = input;
            
            // Define task-critical keywords that should NEVER be removed
            const criticalWords = {
                email: ['email', 'e-mail', 'mail', 'message', 'letter'],
                presentation: ['presentation', 'slide', 'slides', 'deck', 'powerpoint', 'ppt'],
                analysis: ['analyze', 'analysis', 'summary', 'report', 'document', 'review'],
                content: ['blog', 'article', 'post', 'content', 'write', 'whitepaper'],
                brainstorm: ['ideas', 'brainstorm', 'suggestions', 'options'],
                data: ['data', 'spreadsheet', 'excel', 'chart', 'graph']
            };
            
            const protected = criticalWords[taskType] || [];
            
            // Create regex pattern for protected words
            const protectedPattern = protected.length > 0 ? 
                new RegExp(`\\b(${protected.join('|')})\\b`, 'gi') : null;
            
            // Mark protected words with placeholders
            const placeholders = new Map();
            if (protectedPattern) {
                let counter = 0;
                cleaned = cleaned.replace(protectedPattern, (match) => {
                    const placeholder = `__PROTECTED_${counter}__`;
                    placeholders.set(placeholder, match);
                    counter++;
                    return placeholder;
                });
            }
            
            // Now safe to remove fillers
            const fillers = [
                /\b(um|uh|umm|uhh|hmm)\b/gi,
                /\b(like|you know|I mean|sort of|kind of)\b/gi,
                /\b(actually|basically|literally)\b/gi,
                /\b(so yeah|yeah so|and yeah|okay|ok|alright)\b/gi,
                /\b(I guess|I think maybe|probably|perhaps)\b/gi,
                /\b(let me see|let's see|well)\b/gi
            ];
            
            fillers.forEach(pattern => {
                cleaned = cleaned.replace(pattern, ' ');
            });
            
            // Remove repeated words carefully
            cleaned = cleaned.replace(/\b(\w+)\s+\1\b/gi, '$1');
            
            // Fix common contractions
            cleaned = cleaned.replace(/\bwanna\b/gi, 'want to');
            cleaned = cleaned.replace(/\bgonna\b/gi, 'going to');
            cleaned = cleaned.replace(/\bgotta\b/gi, 'got to');
            
            // Clean up multiple spaces
            cleaned = cleaned.replace(/\s+/g, ' ');
            
            // Restore protected words
            placeholders.forEach((original, placeholder) => {
                cleaned = cleaned.replace(placeholder, original);
            });
            
            return cleaned.trim();
        }
        
        function analyzeInput(cleanedInput, rawInput, taskType) {
            // Extract all components with validation
            const numbers = extractNumbersWithContext(cleanedInput, taskType);
            const audience = extractAudienceAdvanced(cleanedInput);
            const tone = extractToneAdvanced(cleanedInput);
            const topics = extractTopicsAdvanced(cleanedInput);
            const deadline = extractDeadline(cleanedInput);
            const constraints = extractConstraintsIntelligent(cleanedInput);
            const purpose = extractPurpose(cleanedInput);
            
            return {
                taskType,
                numbers,
                audience,
                tone,
                topics,
                deadline,
                constraints,
                purpose,
                cleanedInput,
                rawInput
            };
        }
        
        function extractNumbersWithContext(input, taskType) {
            const numbers = {};
            const lower = input.toLowerCase();
            
            // Context-aware number extraction
            
            // Slides (but watch for "200 people" not being "200 slides")
            const slidePatterns = [
                /(\d+)\s*slides?/i,
                /(\d+)\s*[-–]\s*slide/i,
                /about\s+(\d+)\s+slides?/i
            ];
            
            for (const pattern of slidePatterns) {
                const match = lower.match(pattern);
                if (match && taskType === 'presentation') {
                    const num = parseInt(match[1]);
                    // Sanity check: typical presentations are 5-50 slides
                    if (num >= 3 && num <= 100) {
                        numbers.slides = num;
                        break;
                    }
                }
            }
            
            // If no slides found but numbers exist, make reasonable guess
            if (!numbers.slides && taskType === 'presentation') {
                const allNums = input.match(/\b(\d+)\b/g);
                if (allNums) {
                    // Look for reasonable slide counts (avoid "200 people")
                    const reasonable = allNums.map(n => parseInt(n)).filter(n => n >= 3 && n <= 100);
                    if (reasonable.length > 0) {
                        // Check context: not "people", not "words"
                        for (const num of reasonable) {
                            const context = input.match(new RegExp(`\\b${num}\\s+(\\w+)`, 'i'));
                            if (context && !context[1].match(/people|person|attendee|word|minute|hour|day/i)) {
                                numbers.slides = num;
                                break;
                            }
                        }
                    }
                }
            }
            
            // Word counts
            const wordMatch = input.match(/(\d+)\s*(word|words)/i);
            if (wordMatch) {
                numbers.words = parseInt(wordMatch[1]);
            }
            
            // Duration
            const timeMatch = input.match(/(\d+)\s*(minute|minutes|min|mins|hour|hours|hr|hrs)/i);
            if (timeMatch) {
                numbers.duration = parseInt(timeMatch[1]);
            }
            
            // Item counts for brainstorming
            const itemPatterns = [
                /(\d+)\s*(ideas?|options?|ways?|suggestions?|items?)/i,
                /(top|give me|need)\s+(\d+)/i
            ];
            
            for (const pattern of itemPatterns) {
                const match = input.match(pattern);
                if (match && taskType === 'brainstorm') {
                    const numIndex = match[1].match(/\d/) ? 1 : 2;
                    numbers.items = parseInt(match[numIndex]);
                    break;
                }
            }
            
            return numbers;
        }
        
        function extractAudienceAdvanced(input) {
            const lower = input.toLowerCase();
            
            // Multi-word audience detection with fuzzy matching
            if (lower.match(/\b(board\s+meeting|board\s+members?|board of directors)\b/i))
                return 'board members or executives';
            
            if (lower.match(/\b(doctor|doctors|physician|healthcare administrator|medical professional)\b/i))
                return 'healthcare professionals';
            
            if (lower.match(/\b(client|customer|buyer|purchaser)\b/))
                return 'clients or customers';
            
            if (lower.match(/\b(team|staff|colleagues?|employees?|coworkers?)\b/))
                return 'internal team';
            
            if (lower.match(/\b(executive|exec|c-suite|management|leadership|ceo|cfo|cto|boss|manager)\b/))
                return 'executives or leadership';
            
            if (lower.match(/\b(investor|stakeholder|shareholder|fund)\b/))
                return 'investors or stakeholders';
            
            if (lower.match(/\b(student|beginner|novice|new to|learning|starter)\b/))
                return 'beginners or learners';
            
            if (lower.match(/\b(expert|specialist|professional|advanced|technical audience)\b/))
                return 'experts or professionals';
            
            if (lower.match(/\b(general public|everyone|anyone|consumers?|readers?)\b/))
                return 'general audience';
            
            // Look for "to [Name]" pattern (email recipient)
            const recipientMatch = input.match(/\b(to|for)\s+([A-Z][a-z]+)\b/);
            if (recipientMatch) {
                return `${recipientMatch[2]} (specific recipient)`;
            }
            
            return null;
        }
        
        function extractToneAdvanced(input) {
            const lower = input.toLowerCase();
            
            // Handle contradictions like "professional but not too formal"
            let toneComponents = [];
            
            if (lower.match(/\bprofessional\b/) && lower.match(/\bnot\s+too\s+(formal|stiff)\b/))
                return 'professional but approachable';
            
            if (lower.match(/\bformal\b/) && lower.match(/\b(but also|yet)\s+(friendly|warm)\b/))
                return 'formal yet friendly';
            
            // Standard tone detection
            if (lower.match(/\b(professional|formal|business-like)\b/))
                toneComponents.push('professional');
            
            if (lower.match(/\b(casual|friendly|informal|relaxed|conversational)\b/))
                toneComponents.push('casual and friendly');
            
            if (lower.match(/\b(persuasive|convincing|compelling|sell)\b/))
                toneComponents.push('persuasive');
            
            if (lower.match(/\b(urgent|asap|critical|important|immediately)\b/))
                toneComponents.push('urgent');
            
            if (lower.match(/\b(technical|detailed|in-depth|comprehensive)\b/))
                toneComponents.push('technical and detailed');
            
            if (lower.match(/\b(simple|easy|clear|straightforward|accessible)\b/))
                toneComponents.push('simple and clear');
            
            if (lower.match(/\b(engaging|entertaining|fun|interesting)\b/))
                toneComponents.push('engaging');
            
            // Handle "not too" negations
            if (lower.match(/\bnot\s+too\s+(formal|stiff|serious)\b/)) {
                toneComponents = toneComponents.filter(t => t !== 'professional');
                toneComponents.push('approachable');
            }
            
            return toneComponents.length > 0 ? toneComponents.join(', ') : null;
        }
        
        function extractTopicsAdvanced(input) {
            const topics = new Set();
            
            // Pattern 1: "about X"
            const aboutMatches = input.matchAll(/\b(about|regarding|concerning|on)\s+([^,.]{3,40}?)(?=\s+(?:and|,|for|to|\.|$))/gi);
            for (const match of aboutMatches) {
                const topic = match[2].trim();
                // Filter out meaningless topics
                if (!topic.match(/^(the|this|that|it|maybe|perhaps)$/i)) {
                    topics.add(topic);
                }
            }
            
            // Pattern 2: "for the X meeting/project"
            const projectMatches = input.matchAll(/\b(?:for|at)\s+(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+){0,2})\s+(?:meeting|project|conference|event)/gi);
            for (const match of projectMatches) {
                topics.add(match[1].trim());
            }
            
            // Pattern 3: Key noun phrases after specific verbs
            const verbPatterns = [
                /\b(?:presenting|discussing|covering|explaining|analyzing)\s+([^,.]{3,40}?)(?=\s+(?:and|,|for|to|\.|$))/gi
            ];
            
            for (const pattern of verbPatterns) {
                const matches = input.matchAll(pattern);
                for (const match of matches) {
                    const topic = match[1].trim();
                    if (!topic.match(/^(the|this|that|it)$/i)) {
                        topics.add(topic);
                    }
                }
            }
            
            return Array.from(topics);
        }
        
        function extractDeadline(input) {
            const lower = input.toLowerCase();
            
            if (lower.match(/\b(today|asap|urgent|immediately|right now)\b/))
                return 'urgent (today)';
            if (lower.match(/\b(tomorrow|by tomorrow|next day)\b/))
                return 'tomorrow';
            if (lower.match(/\b(next week|in a week)\b/))
                return 'next week';
            if (lower.match(/\b(this week|by friday|end of week)\b/))
                return 'this week';
            if (lower.match(/\b(two weeks|2 weeks|in two weeks)\b/))
                return 'two weeks';
            if (lower.match(/\b(next month|in a month)\b/))
                return 'next month';
            
            return null;
        }
        
        function extractConstraintsIntelligent(input) {
            const constraints = [];
            const lower = input.toLowerCase();
            
            // Handle contradictions intelligently
            const hasConcise = lower.match(/\b(short|brief|quick|concise|succinct)\b/);
            const hasDetailed = lower.match(/\b(long|detailed|comprehensive|thorough|in-depth)\b/);
            
            // Don't add contradictory constraints
            if (hasConcise && !hasDetailed) {
                constraints.push('Keep it concise and to the point');
            } else if (hasDetailed && !hasConcise) {
                constraints.push('Provide detailed, comprehensive coverage');
            } else if (hasConcise && hasDetailed) {
                // User wants both - interpret as "concise but thorough"
                constraints.push('Be thorough but concise');
            }
            
            // Format constraints
            if (lower.match(/\b(bullet points?|lists?|numbered)\b/))
                constraints.push('Use bullet points or lists for clarity');
            
            if (lower.match(/\b(no bullet|paragraph|prose|narrative)\b/))
                constraints.push('Write in paragraph format');
            
            // Clarity constraints
            if (lower.match(/\b(simple|easy|accessible|layman|non-technical|avoid jargon)\b/))
                constraints.push('Use simple, accessible language');
            
            if (lower.match(/\b(engaging|interesting|not boring|keep it fun)\b/))
                constraints.push('Make it engaging and interesting');
            
            if (lower.match(/\b(actionable|practical|useful|applicable)\b/))
                constraints.push('Focus on actionable, practical advice');
            
            return constraints;
        }
        
        function extractPurpose(input) {
            const lower = input.toLowerCase();
            
            // Try to find purpose statements
            const purposePatterns = [
                /\b(?:need|want|looking|trying)\s+to\s+([^,.!?]{5,60}?)(?=\s+(?:for|to|and|,|\.|$))/i,
                /\b(?:goal|purpose|aim)\s+is\s+to\s+([^,.!?]{5,60})/i,
                /\b(?:help|assist)(?:\s+me)?\s+(?:with|to)\s+([^,.!?]{5,60})/i
            ];
            
            for (const pattern of purposePatterns) {
                const match = input.match(pattern);
                if (match) {
                    let purpose = match[1].trim();
                    // Clean up common issues
                    purpose = purpose.replace(/\s+/g, ' ');
                    if (purpose.length > 10 && purpose.length < 100) {
                        return purpose;
                    }
                }
            }
            
            return null;
        }
        
        function displayDetectionResults(analysis) {
            const { taskType, numbers, audience, tone, topics, deadline, constraints, purpose } = analysis;
            
            let html = `<strong>Task type:</strong> ${taskType}<br>`;
            
            if (purpose) {
                html += `<strong>Purpose:</strong> ${purpose}<br>`;
            }
            
            if (audience) {
                html += `<strong>Audience:</strong> ${audience}<br>`;
            }
            
            if (tone) {
                html += `<strong>Tone:</strong> ${tone}<br>`;
            }
            
            if (topics && topics.length > 0) {
                html += `<strong>Topics:</strong> ${topics.join(', ')}<br>`;
            }
            
            if (Object.keys(numbers).length > 0) {
                html += `<strong>Specifications:</strong> `;
                const specs = [];
                if (numbers.slides) specs.push(`${numbers.slides} slides`);
                if (numbers.words) specs.push(`${numbers.words} words`);
                if (numbers.items) specs.push(`${numbers.items} items`);
                if (numbers.duration) specs.push(`${numbers.duration} min`);
                html += specs.join(', ') + '<br>';
            }
            
            if (deadline) {
                html += `<strong>Timeline:</strong> ${deadline}<br>`;
            }
            
            if (constraints && constraints.length > 0) {
                html += `<strong>Requirements:</strong><br>`;
                constraints.forEach(c => html += `&nbsp;&nbsp;• ${c}<br>`);
            }
            
            document.getElementById('detectedInfo').innerHTML = html;
            document.getElementById('detectionResults').style.display = 'block';
        }
        
        function generateOptimizedPrompt(cleanedInput, analysis) {
            const { taskType, numbers, audience, tone, topics, deadline, constraints, purpose } = analysis;
            
            let prompt = '';
            
            // Task-specific templates with enhanced context
            switch (taskType) {
                case 'presentation':
                    prompt = generatePresentationPrompt(cleanedInput, analysis);
                    break;
                case 'email':
                    prompt = generateEmailPrompt(cleanedInput, analysis);
                    break;
                case 'analysis':
                    prompt = generateAnalysisPrompt(cleanedInput, analysis);
                    break;
                case 'content':
                    prompt = generateContentPrompt(cleanedInput, analysis);
                    break;
                case 'brainstorm':
                    prompt = generateBrainstormPrompt(cleanedInput, analysis);
                    break;
                case 'data':
                    prompt = generateDataPrompt(cleanedInput, analysis);
                    break;
                default:
                    prompt = generateGeneralPrompt(cleanedInput, analysis);
            }
            
            return prompt;
        }
        
        function generatePresentationPrompt(input, analysis) {
            const { numbers, audience, tone, topics, deadline, constraints } = analysis;
            
            // Default to reasonable slide count if not specified or unreasonable
            let slideCount = 10; // sensible default
            if (numbers.slides && numbers.slides >= 3 && numbers.slides <= 100) {
                slideCount = numbers.slides;
            }
            
            const audienceText = audience || 'the intended audience (please specify for better results)';
            
            let prompt = `I need help creating a ${slideCount}-slide presentation.

**Context from my request:**
${input}

**Presentation requirements:**

1. **Structure and content:**
   - Provide a complete outline with suggested content for each of the ${slideCount} slides
   - For each slide, include:
     * Compelling slide title
     * 3-4 key points or main messages
     * Recommended visual elements (charts, images, diagrams, icons)
     * Any data or statistics that would strengthen the message

2. **Flow and narrative:**
   - Opening slide: Create a hook that captures attention immediately
   - Main content: Organize slides to tell a logical, compelling story
   - Conclusion: Strong closing with clear takeaways and call to action
   - Ensure smooth transitions between topics

3. **Audience consideration:**
   - Target audience: ${audienceText}`;
            
            if (tone) {
                prompt += `\n   - Tone: ${tone}`;
            }
            
            if (topics && topics.length > 0) {
                prompt += `\n   - Key topics to cover: ${topics.join(', ')}`;
            }
            
            prompt += `\n\n4. **Visual recommendations:**
   - Suggest specific chart types, imagery, or layouts for each slide
   - Indicate which slides need data visualizations vs. conceptual diagrams
   - Note any slides that would benefit from icons or illustrations
   - Keep text minimal on slides (use speaker notes for details)`;
            
            if (constraints && constraints.length > 0) {
                prompt += `\n\n5. **Special requirements:**\n`;
                constraints.forEach(c => prompt += `   - ${c}\n`);
            }
            
            if (deadline) {
                prompt += `\n\n**Timeline:** ${deadline}`;
            }
            
            prompt += `\n\nPlease also provide speaker notes or talking points for the 3-5 most critical slides in the presentation.`;
            
            // Add note about supporting materials if mentioned
            if (input.match(/\b(handout|one-pager|supporting|document|materials)\b/i)) {
                prompt += `\n\nAdditionally, suggest what supporting materials (handouts, one-pagers) would complement this presentation.`;
            }
            
            return prompt;
        }
        
        function generateEmailPrompt(input, analysis) {
            const { audience, tone, topics, deadline, purpose, numbers } = analysis;
            
            // Extract recipient name if present
            let recipientText = audience || 'the recipient';
            const toneText = tone || 'professional yet approachable';
            
            let prompt = `I need to draft an email with the following context:

**What I need:**
${input}

**Email specifications:**

1. **Audience and tone:**
   - Recipient: ${recipientText}
   - Desired tone: ${toneText}`;
            
            if (purpose) {
                prompt += `\n   - Purpose: ${purpose}`;
            }
            
            if (topics && topics.length > 0) {
                prompt += `\n   - Key topics to address: ${topics.join(', ')}`;
            }
            
            prompt += `\n\n2. **Email structure:**
   - Subject line: Clear, specific, and appropriate for the situation
   - Greeting: Match the formality level to the relationship
   - Opening: Establish context quickly and clearly (1-2 sentences)
   - Body: Present information in 2-3 focused paragraphs
     * First paragraph: Main message or request
     * Second paragraph: Supporting details, explanation, or context
     * Third paragraph (if needed): Additional information or alternatives
   - Closing: Include clear next steps or call to action
   - Sign-off: Professional and appropriate

3. **Content guidelines:**
   - Be direct and respectful of the recipient's time
   - Keep email under 200 words unless complexity requires more
   - Make the main point clear in the first paragraph
   - Use specific details where relevant
   - Anticipate and address potential questions`;
            
            if (deadline) {
                prompt += `\n   - Timeline/urgency: ${deadline}`;
            }
            
            prompt += `\n\n4. **Additional requests:**
   - After drafting, briefly explain your key choices
   - Suggest an alternative subject line option
   - Note any important considerations for this type of communication`;
            
            return prompt;
        }
        
        function generateAnalysisPrompt(input, analysis) {
            const { topics, audience, constraints, deadline } = analysis;
            
            let prompt = `I need a thorough analysis of the following:

**What needs to be analyzed:**
${input}

**Analysis structure:**

1. **Executive summary** (2-3 sentences)
   - Highlight the most critical findings upfront
   - Focus on actionable insights

2. **Key findings:**
   - Present main insights with supporting evidence
   - Use specific data points, quotes, or examples from the source material
   - Organize from most to least significant

3. **Detailed examination:**
   - Break down the subject systematically`;
            
            if (topics && topics.length > 0) {
                prompt += `\n   - Pay particular attention to: ${topics.join(', ')}`;
            }
            
            prompt += `\n   - Explain the significance of important patterns or trends
   - Note any surprising discoveries or outliers
   - Consider both quantitative and qualitative aspects

4. **Implications and context:**
   - What do these findings mean in practical terms?
   - How do they relate to broader trends or concerns?
   - What are the potential consequences or applications?

5. **Recommendations:**
   - Provide 3-5 specific, actionable recommendations
   - Prioritize by impact and feasibility
   - Explain the reasoning behind each recommendation

6. **Considerations and limitations:**
   - Note any caveats or uncertainties
   - Identify gaps in information
   - Suggest areas for further investigation`;
            
            if (audience) {
                prompt += `\n\n**Audience:** Tailor the analysis for ${audience}`;
            }
            
            if (constraints && constraints.length > 0) {
                prompt += `\n\n**Constraints:**\n`;
                constraints.forEach(c => prompt += `- ${c}\n`);
            }
            
            if (deadline) {
                prompt += `\n**Timeline:** ${deadline}`;
            }
            
            prompt += `\n\nPlease cite specific sections or evidence throughout your analysis.`;
            
            // If user mentioned presenting findings, clarify format
            if (input.match(/\bpresent\b/i)) {
                prompt += `\n\n**Note:** Provide the analysis in a clear, written format. If you need to present these findings to others, I can help create presentation slides based on this analysis afterward.`;
            }
            
            return prompt;
        }
        
        function generateContentPrompt(input, analysis) {
            const { numbers, audience, tone, topics, constraints } = analysis;
            const wordCount = numbers.words || 800;
            const audienceText = audience || 'your target readers (consider specifying for better results)';
            const toneText = tone || 'engaging and informative';
            
            let prompt = `I need to create content based on this request:

**What I'm looking for:**
${input}

**Content specifications:**

1. **Core requirements:**
   - Target audience: ${audienceText}
   - Approximate length: ${wordCount} words
   - Tone and style: ${toneText}`;
            
            if (topics && topics.length > 0) {
                prompt += `\n   - Topics to cover: ${topics.join(', ')}`;
            }
            
            prompt += `\n\n2. **Structure and flow:**
   - Opening: Create a hook that immediately engages the reader
   - Body: Organize content with clear progression and logical sections
   - Include specific examples, anecdotes, or case studies
   - Closing: Strong conclusion with memorable takeaways

3. **Content quality:**
   - Make it practical and actionable where relevant
   - Balance information with readability
   - Use concrete details rather than vague generalities
   - Incorporate relevant data or research if appropriate`;
            
            // Only add non-contradictory constraints
            if (constraints && constraints.length > 0) {
                prompt += `\n\n4. **Special requirements:**\n`;
                constraints.forEach(c => prompt += `   - ${c}\n`);
            }
            
            prompt += `\n\n5. **Additional deliverables:**
   - Suggest 3 compelling title options
   - Identify 4-5 key points that must be included
   - Recommend content format (blog post, article, guide, white paper)
   - Note where visual elements would enhance the content (charts, images, infographics)

Please ensure the content is well-researched and authoritative while remaining accessible to the target audience.`;
            
            return prompt;
        }
        
        function generateBrainstormPrompt(input, analysis) {
            const { numbers, constraints, purpose, deadline } = analysis;
            const itemCount = numbers.items || 10;
            
            let prompt = `I need creative brainstorming help for:

**The challenge:**
${input}`;
            
            if (purpose) {
                prompt += `\n\n**Goal:** ${purpose}`;
            }
            
            prompt += `\n\n**Brainstorming structure:**

1. **Generate ${itemCount} diverse ideas** that address this need

2. **For each idea, provide:**
   - Clear, descriptive name
   - Brief explanation (2-3 sentences) of how it works
   - Key benefits and advantages
   - Potential challenges or considerations
   - Estimated difficulty level (easy, moderate, challenging)

3. **Organize by category:**
   - Quick wins (can be implemented immediately)
   - Medium-term initiatives (require some planning)
   - Long-term strategies (significant investment or time)

4. **Budget consideration:**
   - Identify 3 low-cost or no-cost options
   - Note 2-3 premium options that require investment
   - Explain the value proposition for higher-cost ideas`;
            
            if (constraints && constraints.length > 0) {
                prompt += `\n\n5. **Constraints to consider:**\n`;
                constraints.forEach(c => prompt += `   - ${c}\n`);
            }
            
            if (deadline) {
                prompt += `\n\n**Timeline:** ${deadline}`;
            }
            
            prompt += `\n\n6. **Final recommendations:**
   - Highlight your top 3 recommendations
   - Explain why these stand out
   - Suggest a practical implementation sequence

Think creatively and include both conventional and innovative approaches. Don't just list obvious ideas - push for creative solutions.`;
            
            return prompt;
        }
        
        function generateDataPrompt(input, analysis) {
            const { topics, audience } = analysis;
            
            let prompt = `I need help with data analysis and presentation:

**Data context:**
${input}

**Analysis requirements:**

1. **Initial approach:**
   - Identify the key questions this data should answer
   - Determine which metrics or patterns are most important
   - Outline the analysis methodology`;
            
            if (topics && topics.length > 0) {
                prompt += `\n   - Focus areas: ${topics.join(', ')}`;
            }
            
            prompt += `\n\n2. **Analysis deliverables:**
   - Calculate and present key statistics (means, medians, totals, etc.)
   - Identify significant trends or patterns
   - Highlight outliers, anomalies, or unexpected findings
   - Compare across relevant dimensions or time periods

3. **Visualization strategy:**
   - Recommend 4-5 specific chart or graph types
   - For each visualization, explain:
     * What insight it reveals
     * Why this format is most effective
     * What audience should focus on

4. **Data presentation:**
   - Organize findings in a clear, logical structure
   - Use tables for detailed comparisons
   - Provide both summary views and detailed breakdowns
   - Make the data story easy to follow

5. **Insights and actions:**
   - What story does this data tell?
   - What are the key takeaways?
   - What decisions or actions does this support?
   - What questions remain unanswered?`;
            
            if (audience) {
                prompt += `\n\n**Presentation audience:** ${audience} (adjust complexity accordingly)`;
            }
            
            prompt += `\n\nPlease structure the analysis for easy scanning and quick comprehension.`;
            
            return prompt;
        }
        
        function generateGeneralPrompt(input, analysis) {
            const { audience, tone, topics, constraints, purpose } = analysis;
            
            let prompt = `I need assistance with the following:

**My request:**
${input}`;
            
            if (purpose) {
                prompt += `\n\n**Goal:** ${purpose}`;
            }
            
            // Since this is general/unclear, acknowledge it
            prompt += `\n\n**Note:** Your request could be interpreted in a few ways. I'll provide the best response I can, but if you'd like to clarify whether you need:
- A document or presentation created
- An email or message drafted
- Content written (blog post, article, etc.)
- Data or information analyzed
- Ideas brainstormed
...please let me know and I can tailor my response more specifically.

**Response structure:**

1. **Task clarification:**
   - Confirm your understanding of what needs to be accomplished
   - Note any assumptions being made
   - Ask for clarification if critical information is missing

2. **Approach:**`;
            
            if (audience) {
                prompt += `\n   - Consider the audience: ${audience}`;
            }
            
            if (tone) {
                prompt += `\n   - Match the tone: ${tone}`;
            }
            
            if (topics && topics.length > 0) {
                prompt += `\n   - Address these topics: ${topics.join(', ')}`;
            }
            
            prompt += `\n   - Organize information logically with clear sections
   - Include specific examples or concrete details
   - Provide actionable insights where relevant

3. **Multiple perspectives:**
   - If there are different valid approaches, present them
   - Explain the pros and cons of each option
   - Recommend the best approach for this specific situation
   - Explain your reasoning`;
            
            if (constraints && constraints.length > 0) {
                prompt += `\n\n4. **Constraints to observe:**\n`;
                constraints.forEach(c => prompt += `   - ${c}\n`);
            }
            
            prompt += `\n\nPlease be thorough and explain your reasoning at key decision points.`;
            
            return prompt;
        }
        
        function copyPrompt() {
            const promptText = document.getElementById('optimizedPrompt').value;
            
            if (!promptText) {
                alert('Generate a prompt first!');
                return;
            }
            
            navigator.clipboard.writeText(promptText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                alert('Failed to copy. Please copy manually.');
            });
        }
    </script>
</body>
</html>
